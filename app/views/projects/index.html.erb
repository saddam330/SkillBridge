<div class="container mt-4">

  <!-- Page Heading -->
  <p class="text-muted">Home > Internship</p>
  <h1 class="mb-4 fw-bold fs-2">Browse Projects</h1>

  <%= form_with url: projects_path, method: :get, local: true do %>

    <!-- 🔍 Search Bar at the Top -->
    <div class="input-group mb-4">
      <span class="input-group-text"><i class="bi bi-search"></i></span>
      <%= text_field_tag :query, params[:query], class: "form-control", placeholder: "Search for projects..." %>
      <button class="btn btn-primary">Search</button>
    </div>

    <!-- 🔲 Filters and Projects Row -->
    <div class="row">

      <!-- Sidebar Filters -->
      <aside class="col-md-3">
        <div class="card mb-4">
          <div class="card-header d-flex justify-content-between align-items-center">
            <strong><i class="bi bi-filter"></i> Filters</strong>
            <%= link_to "Clear all", projects_path, class: "text-decoration-none text-primary small" %>
          </div>

          <div class="card-body">

            <!-- Location Type -->
            <h6 class="text-muted">Location type</h6>
            <% ["Remote", "Hybrid", "On-site"].each do |loc| %>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="location[]" value="<%= loc %>" onchange="this.form.submit()"
                       <%= 'checked' if params[:location]&.include?(loc) %>>
                <label class="form-check-label" for="<%= loc.downcase %>"><%= loc %></label>
              </div>
            <% end %>

            <hr>

            <!-- Duration -->
            <h6 class="text-muted">Duration</h6>
            <% Project.pluck(:duration).uniq.each do |val, label| %>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="duration[]" value="<%= val %>" onchange="this.form.submit()"
                       <%= 'checked' if params[:duration]&.include?(val) %>>
                <label class="form-check-label" for="duration-<%= val %>"><%= label %></label>
              </div>
            <% end %>

            <hr>

            <!-- Category -->
          <h6 class="text-muted">Category</h6>
            <% Project.pluck(:category).uniq.each do |cat| %>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="category[]" value="<%= cat %>" onchange="this.form.submit()"
                       <%= 'checked' if params[:category]&.include?(cat) %>>
                <label class="form-check-label" for="<%= cat.downcase %>"><%= cat %></label>
              </div>
            <% end %>

          </div>
        </div>
      </aside>

      <!-- Main Projects Area -->
      <main class="col-md-9">

        <div class="row row-cols-1 row-cols-md-2 g-4">
          <% @projects.each do |project| %>
            <div class="col">
              <div class="card h-100 shadow-sm position-relative">
                <div class="card-body d-flex justify-content-between">
                  <div>
                    <h5 class="card-title mb-1"><%= project.project_title %></h5>
                    <h6 class="card-subtitle text-muted"><%= project.requirements %></h6>
                    <p class="card-text mt-2"><%= truncate(project.project_description, length: 100) %></p>
                    <p class="text-muted small">
                      <i class="bi bi-geo-alt-fill"></i> <%= project.location %> |
                      <i class="bi bi-hourglass-split"></i> <%= project.duration %> |
                      <i class="bi bi-clock-history"></i> Posted <%= time_ago_in_words(project.created_at) %> ago
                    </p>
                    <% if project.category.present? %>
                      <span class="pill"><%= project.category %></span>
                    <% end %>
                  </div>
                  <div class="text-end">
                    <%= button_to "Apply", apply_project_path(project), method: :post, class: "btn btn-primary" %>
                  </div>
                </div>
                <button class="btn btn-light border-0 position-absolute bottom-0 end-0 m-2">
                  <i class="bi bi-bookmark-fill"></i>
                </button>
              </div>
            </div>
          <% end %>
        </div>

      </main>
    </div>

  <% end %>
</div>
